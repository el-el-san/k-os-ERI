{{ define "main" }}
  <div class="doc-meta">{{ .Site.Params.description }}</div>
  
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ -->
  {{ if .Params.hero_image }}
  <div class="hero" id="docHero">
    <img src="{{ .Params.hero_image }}" alt="{{ .Params.hero_alt | default "Hero Image" }}">
  </div>
  {{ end }}
  
  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  {{/* çµ±åˆãƒ‡ãƒ¼ã‚¿: sections.yaml + data/saas/*.yaml */}}
  {{ $all := slice }}
  {{ range .Site.Data.sections }}
    {{ $all = $all | append . }}
  {{ end }}
  {{ with .Site.Data.saas }}
    {{ range $k, $arr := . }}
      {{ range $arr }}
        {{/* private_ã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ã€source_fileãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ  */}}
        {{ $item := . }}
        {{ if hasPrefix $k "private_" }}
          {{ $item = $item | merge (dict "source_file" $k "is_private" true) }}
        {{ else }}
          {{ $item = $item | merge (dict "source_file" $k "is_private" false) }}
        {{ end }}
        {{ $all = $all | append $item }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ range $all }}
  <section class="doc-section" id="{{ .id }}" data-cat="{{ .category }}" data-cat-name="{{ .category_name }}" data-is-private="{{ .is_private }}">
    <h2>{{ if .is_private }}<span aria-label="ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«">ğŸ”’</span> {{ end }}{{ .title }}</h2>
    {{ if hasPrefix .id "requirements-" }}
      {{ $item := . }}
      {{ $secId := .id }}
      {{/* åˆæœŸã¯ã‚«ãƒ¼ãƒ‰ã®ã¿è¡¨ç¤ºã—ã€ã‚¯ãƒªãƒƒã‚¯ã§è¦ä»¶å®šç¾©æ›¸æœ¬ä½“ã‚’è¡¨ç¤º */}}
      <style>
        /* 2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆè¦ä»¶å®šç¾©æ›¸ã®ã‚«ãƒ¼ãƒ‰å°‚ç”¨ï¼‰ */
        #requirementsDocCard-{{ $secId }} { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 20px; }
        #requirementsDocCard-{{ $secId }} > * { min-width: 0; }
        #requirementsDocCard-{{ $secId }} a.saas-app-card { min-width: 0; }
        @media (max-width: 900px){ #requirementsDocCard-{{ $secId }} { grid-template-columns: 1fr; } }
      </style>
      <div id="requirementsDocCard-{{ $secId }}" class="dashboard-links" style="margin-top: 8px; display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 20px;">
        <a href="#{{ $secId }}" class="saas-app-card" onclick="(function(){
          var card = document.getElementById('requirementsDocCard-{{ $secId }}');
          var body = document.getElementById('requirementsDocBody-{{ $secId }}');
          if(card && body){ card.style.display='none'; body.style.display='block'; window.scrollTo(0,0); }
        })(); return false;">
          {{ with .image }}
            <img src="{{ . }}" alt="{{ $item.title }}" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">
          {{ end }}
          <div class="saas-app-title">
            {{ .title }}
            <span class="saas-app-arrow">â†’</span>
          </div>
          {{ with .content }}
          <div class="saas-app-description">{{ . | markdownify }}</div>
          {{ end }}
          <div class="saas-app-features">
            â€¢ æ¦‚è¦ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æ<br>
            â€¢ æ©Ÿèƒ½è¦ä»¶ãƒ»éæ©Ÿèƒ½è¦ä»¶<br>
            â€¢ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»å®Ÿè£…ãƒ»é‹ç”¨
          </div>
        </a>

        {{ if eq $secId "requirements-document" }}
        <a href="#requirements-kamui-os" class="saas-app-card" onclick="(function(){
          if (window.showRequirements) {
            window.showRequirements('kamui-os');
            setTimeout(function(){
              var c = document.getElementById('requirementsDocCard-requirements-kamui-os');
              var b = document.getElementById('requirementsDocBody-requirements-kamui-os');
              if (c && b) { c.style.display='none'; b.style.display='block'; window.scrollTo(0,0); }
            }, 0);
          }
        })(); return false;">
          <img src="/images/requirements_doc_card.png" alt="KAMUI OS è¦ä»¶å®šç¾©æ›¸" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">
          <div class="saas-app-title">
            KAMUI OS è¦ä»¶å®šç¾©æ›¸
            <span class="saas-app-arrow">â†’</span>
          </div>
          <div class="saas-app-description">KAMUI OS æœ¬ä½“ã®è¦ä»¶å®šç¾©æ›¸</div>
          <div class="saas-app-features">
            â€¢ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¦‚è¦<br>
            â€¢ ã‚³ã‚¢æ©Ÿèƒ½ãƒ»éæ©Ÿèƒ½è¦ä»¶<br>
            â€¢ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ãƒ»é‹ç”¨
          </div>
        </a>

        <a href="#requirements-kamui-os-npm" class="saas-app-card" onclick="(function(){
          if (window.showRequirements) {
            window.showRequirements('kamui-os-npm');
            setTimeout(function(){
              var c = document.getElementById('requirementsDocCard-requirements-kamui-os-npm');
              var b = document.getElementById('requirementsDocBody-requirements-kamui-os-npm');
              if (c && b) { c.style.display='none'; b.style.display='block'; window.scrollTo(0,0); }
            }, 0);
          }
        })(); return false;">
          <img src="/images/requirements_doc_card.png" alt="KAMUI OS NPM è¦ä»¶å®šç¾©æ›¸" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">
          <div class="saas-app-title">
            KAMUI OS NPM è¦ä»¶å®šç¾©æ›¸
            <span class="saas-app-arrow">â†’</span>
          </div>
          <div class="saas-app-description">KAMUI OS ã® npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã«é–¢ã™ã‚‹è¦ä»¶å®šç¾©æ›¸</div>
          <div class="saas-app-features">
            â€¢ CLI/ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒæœŸ<br>
            â€¢ å‹å®šç¾©/ãƒ—ãƒ©ã‚°ã‚¤ãƒ³<br>
            â€¢ é…å¸ƒ/äº’æ›æ€§
          </div>
        </a>

        <a href="#requirements-sns-marketing" class="saas-app-card" onclick="(function(){
          if (window.showRequirements) {
            window.showRequirements('sns-marketing');
            setTimeout(function(){
              var c = document.getElementById('requirementsDocCard-requirements-sns-marketing');
              var b = document.getElementById('requirementsDocBody-requirements-sns-marketing');
              if (c && b) { c.style.display='none'; b.style.display='block'; window.scrollTo(0,0); }
            }, 0);
          }
        })(); return false;">
          <img src="/images/sns_marketing_card.png" alt="SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¦ä»¶" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">
          <div class="saas-app-title">
            SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¦ä»¶
            <span class="saas-app-arrow">â†’</span>
          </div>
          <div class="saas-app-description">SNSé‹ç”¨ã®KPI/æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼/ãƒ¬ãƒãƒ¼ãƒˆè¦ä»¶</div>
          <div class="saas-app-features">
            â€¢ KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰<br>
            â€¢ æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼<br>
            â€¢ é€£æº/API/CSV
          </div>
        </a>

        <a href="#requirements-neko-cafe" class="saas-app-card" onclick="(function(){
          if (window.showRequirements) {
            window.showRequirements('neko-cafe');
            setTimeout(function(){
              var c = document.getElementById('requirementsDocCard-requirements-neko-cafe');
              var b = document.getElementById('requirementsDocBody-requirements-neko-cafe');
              if (c && b) { c.style.display='none'; b.style.display='block'; window.scrollTo(0,0); }
            }, 0);
          }
        })(); return false;">
          <img src="/images/requirements_doc_card.png" alt="ãƒã‚³ã‚«ãƒ•ã‚§ è¦ä»¶å®šç¾©æ›¸" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">
          <div class="saas-app-title">
            ãƒã‚³ã‚«ãƒ•ã‚§ è¦ä»¶å®šç¾©æ›¸
            <span class="saas-app-arrow">â†’</span>
          </div>
          <div class="saas-app-description">åœ°åŸŸå¯†ç€ã®çŒ«ã‚«ãƒ•ã‚§ã‚µãƒ¼ãƒ“ã‚¹ã®è¦ä»¶å®šç¾©æ›¸</div>
          <div class="saas-app-features">
            â€¢ äºˆç´„/åœ¨ç±çŒ«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«<br>
            â€¢ ã‚°ãƒƒã‚ºEC/é€šçŸ¥/ãƒ¬ãƒãƒ¼ãƒˆ<br>
            â€¢ SNSé€£æº/åº—èˆ—é‹å–¶
          </div>
        </a>
        {{ end }}
      </div>

      <div id="requirementsDocBody-{{ $secId }}" style="display:none;">
        {{ partial "requirements-document" . }}
      </div>
    {{ else if eq .id "employees-dashboard" }}
      {{/* ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆã‚«ãƒ¼ãƒ‰ä¸€è¦§ï¼‰ */}}
      <style>
        #employeesDashboardCards { 
          display: grid; 
          grid-template-columns: repeat(3, minmax(0, 1fr)); 
          gap: 20px; 
        }
        #employeesDashboardCards > * { min-width: 0; }
        #employeesDashboardCards a.saas-app-card { 
          min-width: 0;
          display: flex;
          flex-direction: column;
        }
        #employeesDashboardCards .employee-video-container {
          position: relative;
          width: 100%;
          padding-bottom: 100%; /* 1:1 ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” */
          overflow: hidden;
          border-radius: 8px;
          margin-bottom: 12px;
        }
        #employeesDashboardCards .employee-video-container video,
        #employeesDashboardCards .employee-video-container img {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        @media (max-width: 900px){ 
          #employeesDashboardCards { grid-template-columns: 1fr; } 
        }
      </style>
      <script>
        // ãƒ‡ãƒãƒƒã‚°ç”¨: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å‹•ç”»ç¢ºèª
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(function() {
            const containers = document.querySelectorAll('#employeesDashboardCards .employee-video-container');
            console.log('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠæ•°:', containers.length);
            containers.forEach(function(container) {
              const video = container.querySelector('video');
              const dataVideo = container.getAttribute('data-video');
              const dataId = container.getAttribute('data-id');
              console.log('ID:', dataId, 'Video Path:', dataVideo, 'Video Element:', video);
              if (video) {
                console.log('Video src:', video.src, 'ReadyState:', video.readyState);
              }
            });
          }, 1000);
        });
      </script>
      <div id="employeesDashboardCards" class="dashboard-links" style="margin-top: 8px; display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 20px;">
        {{ range where $all "category" 10 }}
          {{ if ne .id "employees-dashboard" }}
            {{ $emp := . }}
            <a href="#{{ $emp.id }}" class="saas-app-card" onclick="(function(){
              var target=document.getElementById('{{ $emp.id }}');
              if(target){ document.querySelectorAll('.doc-section').forEach(function(s){s.style.display='none'}); target.style.display='block'; window.scrollTo(0,0); }
            })(); return false;">
              <div class="employee-video-container" data-video="{{ $emp.video }}" data-id="{{ $emp.id }}">
                {{ if $emp.video }}              
                  <video src="{{ $emp.video }}" alt="{{ $emp.title }}" autoplay loop muted playsinline controls></video>
                {{ else if $emp.image }}
                  <img src="{{ $emp.image }}" alt="{{ $emp.title }}" />
                {{ else }}
                  <video src="/videos/agent_card.mp4" alt="{{ $emp.title }}" autoplay loop muted playsinline controls></video>
                {{ end }}
              </div>
              <div class="saas-app-title">{{ $emp.title }}<span class="saas-app-arrow">â†’</span></div>
              {{ with $emp.description }}<div class="saas-app-description">{{ . }}</div>{{ end }}
            </a>
          {{ end }}
        {{ end }}
      </div>
    {{ else if hasPrefix .id "employees_" }}
      {{/* ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè©³ç´°ç”¨ã®å°‚ç”¨ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ« */}}
      {{ partial "employee-detail" . }}
    {{ else }}
      {{ if .content }}
        {{ .content | markdownify }}
      {{ end }}
      
      {{ if .markdown_file }}
        <div class="markdown-body" data-path="{{ .markdown_file }}">
          {{ readFile .markdown_file | markdownify }}
        </div>
      {{ end }}
      {{ if .markdown_files }}
        {{ range .markdown_files }}
          <div class="markdown-body" data-path="{{ . }}">
            {{ readFile . | markdownify }}
          </div>
        {{ end }}
      {{ end }}
      
      {{ if .yaml_files }}
        {{ range .yaml_files }}
          {{ $yamlData := index (index $.Site.Data.saas (replace (path.Base .) ".yaml" "")) 0 }}
          {{ if $yamlData }}
            <div class="markdown-body" data-path="{{ . }}">
              {{ $yamlData.content | markdownify }}
            </div>
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if .image }}
      <div class="section-image">
        <img src="{{ .image }}" alt="{{ .title }}">
      </div>
      {{ end }}
      
      {{ if .table }}
        {{ partial "table" .table }}
      {{ end }}
      
      {{ if .dynamic_table }}
        {{ partial "dynamic-table" . }}
      {{ end }}
      
      {{ if .flow_diagram }}
        {{ partial "flow-diagram" . }}
      {{ end }}
      
      {{ if .mcp_section }}
        {{ partial "mcp-section" . }}
      {{ end }}
      
      {{ if .dynamic_cards }}
        {{ partial "dynamic-cards" . }}
      {{ end }}
      
      {{ if .images }}
        {{ partial "image-grid" .images }}
      {{ end }}
      
      {{ if .mermaid }}
        {{ partial "mermaid" .mermaid }}
      {{ end }}
      
      {{ if .additional_content }}
        {{ .additional_content | markdownify }}
      {{ end }}
      
      {{/* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å†…ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ç¾¤ã¯å‰Šé™¤ */}}
      
      {{ if .custom_html }}
        {{ .custom_html | safeHTML }}
      {{ end }}
      
      {{ if .gantt }}
        {{ partial "gantt" . }}
      {{ end }}
      
      {{ if .additional_mermaid }}
        {{ range .additional_mermaid }}
          {{ partial "mermaid-with-caption" . }}
        {{ end }}
      {{ end }}
      
      {{ if .code }}
        {{ partial "code" .code }}
      {{ end }}
      
      {{ if .cards }}
        {{ partial "cards" .cards }}
      {{ end }}
      
      {{ if .design_specs }}
        {{ partial "design-specs" .design_specs }}
      {{ end }}
      
      {{ if .additional_content }}
        {{ .additional_content | markdownify }}
      {{ end }}
      
      {{ if .client_samples }}
        {{ partial "client-samples" .client_samples }}
      {{ end }}
    {{ end }}
  </section>
  {{ end }}
{{ end }}
